<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Cravengers</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="A ordering system By 12 - Einstein" />
	<meta name="keywords" content="A ordering system By 12 - Einstein" />
	<meta name="author" content="" />

	

	<!-- Facebook and Twitter integration -->
	<meta property="og:title" content="" />
	<meta property="og:image" content="" />
	<meta property="og:url" content="" />
	<meta property="og:site_name" content="" />
	<meta property="og:description" content="" />
	<meta name="twitter:title" content="" />
	<meta name="twitter:image" content="" />
	<meta name="twitter:url" content="" />
	<meta name="twitter:card" content="" />

	<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
	<link rel="shortcut icon" href="favicon.ico">

	<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700,300' rel='stylesheet' type='text/css'>

	<link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
	<link rel="stylesheet" href="{{ url_for('static', filename='css/animate.css') }}">
	<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">


	<!-- Modernizr JS -->
	<script src="{{ url_for('static', filename='js/modernizr-2.6.2.min.js') }}"></script>
	<!-- FOR IE9 below -->
	<!--[if lt IE 9]>
	<script src="js/respond.min.js"></script>
	<![endif]-->

</head>

<body>

	<!-- Nav -->
	<div class="navbar_home" style="display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; background-color: #eab830;">
		<!-- Logo (Left) -->
		<a href="productlistpage.html" class="branding__title btn__standard" style="margin-left: 50px; display: flex; align-items: center;">
			<img src="{{ url_for('main.get_logo_image') }}" style="width: 40px;" />
		</a>

		<!-- Right icons (Search & Profile) -->
		<div style="display: flex; align-items: center;">
			<a href="#" class="btn__standard" style="margin-right: 15px; display: flex; align-items: center;">
				<img src="{{ url_for('main.get_search_image') }}" style="width: 25px;" />
			</a>
			<a href="profilepage.html" class="btn__standard" style="margin-right: 50px; display: flex; align-items: center;">
				<img src="{{ url_for('main.get_user_image') }}" style="width: 25px;" />
			</a>
		</div>
	</div>
  
	<div class="bg-frntpage">
		<div class="container">
			<h1>Cravengers Streak Checker</h1>

			<label for="uid">User ID:</label>
			<input id="uid" value="{{ user_info['UID'] }}" readonly />

			<!-- Progress Bar -->
			<div style="margin-top: 1em;">
				<label>Streak Progress:</label>
				<div style="background-color: #eee; width: 100%; border-radius: 10px; overflow: hidden;">
					<div id="progress-bar" style="height: 20px; background-color: #28a745; width: 0%; transition: width 0.5s;"></div>
				</div>
				<p id="streak-text"></p>
			</div>

			<!-- Result Message -->
			<div id="result" style="margin-top: 1em;">Loading...</div>

			<!-- Claim Button -->
			<button id="claim-btn" style="display:none; margin-top: 1em;" onclick="claimVoucher()">Claim Voucher</button>

			<script>
				const UID = document.getElementById("uid").value;

				async function checkStreak() {
					const result = document.getElementById("result");
					const streakText = document.getElementById("streak-text");
					const progressBar = document.getElementById("progress-bar");
					const claimBtn = document.getElementById("claim-btn");

					result.innerHTML = "Checking streak...";
					claimBtn.style.display = "none";

					try {
					const response = await fetch(`http://` + window.location.host + `/get-streak?uid=${UID}`);
					if (!response.ok) throw new Error("User not found");

					const data = await response.json();

					// Update result
					result.innerHTML = `<p>You have a streak of <strong>${data.streak}</strong> day(s).</p>`;
					streakText.innerText = `Progress: ${Math.min(data.streak, 10)} / 10`;

					// Update progress bar
					const progressPercent = Math.min(data.streak, 10) * 10;
					progressBar.style.width = progressPercent + "%";

					// Show claim button if eligible
					if (data.streak >= 10 && data.voucher_awarded) {
						claimBtn.style.display = "block";
					}
					} catch (err) {
					result.innerHTML = `<p style="color: red;">${err.message}</p>`;
					}
				}

				async function claimVoucher() {
					const result = document.getElementById("result");
					result.innerHTML = "Processing claim...";

					try {
					const response = await fetch(`http://` + window.location.host + `/claim-voucher`, {
						method: "POST",
						headers: { "Content-Type": "application/json" },
						body: JSON.stringify({ uid: UID })
					});

					const data = await response.json();

					if (response.ok) {
						result.innerHTML = `<p style="color: green;">${data.message}</p>`;
						document.getElementById("claim-btn").style.display = "none";
					} else {
						result.innerHTML = `<p style="color: red;">${data.message}</p>`;
					}
					} catch (err) {
					result.innerHTML = `<p style="color: red;">Error claiming voucher.</p>`;
					}
				}

				// Run on load
				window.onload = checkStreak;
			</script>
		</div>
	</div>


	<!-- jQuery -->
	<script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
	<!-- Bootstrap -->
	<script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
	<!-- Placeholder -->
	<script src="{{ url_for('static', filename='js/jquery.placeholder.min.js') }}"></script>
	<!-- Waypoints -->
	<script src="{{ url_for('static', filename='js/jquery.waypoints.min.js') }}"></script>
	<!-- Main JS -->
	<script src="{{ url_for('static', filename='js/main.js') }}"></script>

</body>
</html>

<Style>
  .bg-frntpage {
		background:
		linear-gradient(229deg,#AF191A 10%, #F3BD38 46%);
		min-height: 100vh;
		display: flex;
	}
</Style>
